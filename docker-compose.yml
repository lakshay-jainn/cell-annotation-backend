services:
  web:
    build: .
    container_name: myapp-web
    environment:
      - SQL_URI=${SQL_URI}
      - SQS_QUEUE_URL=${SQS_QUEUE_URL}
      - AWS_REGION=${AWS_REGION}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_ENDPOINT_URL=${AWS_ENDPOINT_URL}
      - S3_BUCKET_NAME=${S3_BUCKET_NAME}
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
      - ACCESS_TOKEN_EXPIRY=${ACCESS_TOKEN_EXPIRY}
      - ADMIN_EMAIL=${ADMIN_EMAIL}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD}
      - FRONTEND_URL=${FRONTEND_URL}
      - RECAPTCHA_SECRET=${RECAPTCHA_SECRET}
      - MODEL_API_URL=${MODEL_API_URL}
      - HF_API_KEY=${HF_API_KEY}
    command: gunicorn --bind 0.0.0.0:8000 --workers 2 server:app
    ports:
      - "${WEB_PORT}:8000"
    volumes:
      - .:/app
    networks:
      - myapp-network
    restart: unless-stopped

networks:
  myapp-network:
    driver: bridge
